<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Registrar Barber√≠a ¬∑ Deluxe Barber Shop</title>
  <link href="styles.css" rel="stylesheet">
</head>
<body>
<header class="site-header">
  <div class="navbar container">
    <a class="brand" href="index.html">
      <img src="assets/foto5.png" alt="Deluxe Barber Shop" class="logo-horizontal">
    </a>
    <nav>
      <a href="barberias.html">Barber√≠as</a>
      <a href="registrar.html">Registrar barber√≠a</a>
      <a href="contacto.html">Contacto</a>
    </nav>
    <div class="cta">
      <a class="btn" href="reservas.html">Agendar</a>
    </div>
  </div>
</header>

<main class="container section">
  <h1>Registrar nueva barber√≠a</h1>

  <form id="formBarberia" class="card" style="display:grid; gap:14px;">
    <div class="field">
      <label for="name">Nombre</label>
      <input type="text" id="name" required>
    </div>

    <div class="field">
      <label for="address">Direcci√≥n</label>
      <input type="text" id="address">
    </div>

    <div class="field">
      <label for="city">Ciudad</label>
      <input type="text" id="city">
    </div>

    <div class="field">
      <label for="phone">Tel√©fono</label>
      <input type="text" id="phone">
    </div>

    <div class="field">
      <label for="whatsapp">WhatsApp</label>
      <input type="text" id="whatsapp">
    </div>

    <div class="field">
      <label>Servicios y precios</label>
      <div id="servicesList"></div>
      <div style="display:flex; gap:10px; margin-top:8px;">
        <input type="text" id="serviceName" placeholder="Nombre del servicio">
        <input type="number" id="servicePrice" placeholder="Precio">
        <button type="button" class="btn" id="addService">+</button>
      </div>
    </div>

    <div class="field">
      <label for="logo">Logo de la barber√≠a</label>
      <input type="file" id="logo" name="logo" accept="image/*">
    </div>

    <div class="field">
      <label for="photos">Fotos de la barber√≠a</label>
      <input type="file" id="photos" name="photos" accept="image/*" multiple>
    </div>

    <button type="submit" class="btn">Guardar barber√≠a</button>
    <button type="button" id="btnclear" class="btn ghost">Borrar todas</button>
  </form>
</main>

<footer class="footer">
  <div class="container">¬© <span id="year"></span> Deluxe Barber Shop.</div>
</footer>

<script>
document.getElementById('year').textContent = new Date().getFullYear();

let servicesArr = [];

document.getElementById("addService").addEventListener("click", () => {
  const name = document.getElementById("serviceName").value;
  const price = document.getElementById("servicePrice").value;

  if (!name || !price) {
    alert("Escribe el nombre y el precio del servicio.");
    return;
  }

  servicesArr.push({name, price});
  renderServices();
  document.getElementById("serviceName").value = "";
  document.getElementById("servicePrice").value = "";
});

function renderServices(){
  const list = document.getElementById("servicesList");
  list.innerHTML = servicesArr.map((s,i) => `
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:6px; padding:6px; background:#0f1319; border-radius:8px;">
      <span>${s.name} - $${s.price}</span>
      <button type="button" onclick="removeService(${i})" style="background:red; border:none; color:white; padding:4px 8px; border-radius:6px; cursor:pointer;">x</button>
    </div>
  `).join("");
}

function removeService(i){
  servicesArr.splice(i,1);
  renderServices();
}

document.getElementById("formBarberia").addEventListener("submit", async e => {
  e.preventDefault();

  const name = document.getElementById("name").value;
  const address = document.getElementById("address").value;
  const city = document.getElementById("city").value;
  const phone = document.getElementById("phone").value;
  const whatsapp = document.getElementById("whatsapp").value;

  const logoFile = document.getElementById("logo").files[0];
  const files = document.getElementById("photos").files;

  const newItem = {
    id: Date.now(),
    name,
    address,
    city,
    phone,
    whatsapp,
    services: servicesArr
  };

  await saveBarberia(newItem, files, logoFile);

  alert("Barber√≠a registrada con √©xito ‚úÖ");
  e.target.reset();
  servicesArr = [];
  renderServices();
});
</script>

<!-- üî• Conexi√≥n a Firebase -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
  import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-storage.js";

  // Configuraci√≥n de tu Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyBCFsX78jkxeRO-q0iyVSHe-aEYv0JEZew",
    authDomain: "deluxe-barber-shop-5e9c8.firebaseapp.com",
    projectId: "deluxe-barber-shop-5e9c8",
    storageBucket: "deluxe-barber-shop-5e9c8.firebasestorage.app",
    messagingSenderId: "138851802233",
    appId: "1:138851802233:web:dc73c59db611d8292e08a8"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const storage = getStorage(app);

  // üîπ Funci√≥n global para guardar la barber√≠a
  window.saveBarberia = async function (barberia, fotos, logoFile) {
    try {
      let logoURL = "";
      const fotosURLs = [];

      if (logoFile) {
        const logoRef = ref(storage, `logos/${barberia.id}_${logoFile.name}`);
        await uploadBytes(logoRef, logoFile);
        logoURL = await getDownloadURL(logoRef);
      }

      for (let file of fotos) {
        const fotoRef = ref(storage, `fotos/${barberia.id}_${file.name}`);
        await uploadBytes(fotoRef, file);
        const url = await getDownloadURL(fotoRef);
        fotosURLs.push(url);
      }

      await addDoc(collection(db, "barberias"), {
        ...barberia,
        logo: logoURL,
        fotos: fotosURLs,
        fechaRegistro: new Date().toISOString()
      });

      alert("‚úÖ Barber√≠a guardada en Firebase correctamente.");
    } catch (error) {
      console.error("Error al guardar:", error);
      alert("‚ùå Error al guardar la barber√≠a.");
    }
  };
</script>

</body>
</html>



